import './Card.css'
import { Link } from 'react-router-dom';
import { useState, useEffect } from 'react'
import { useDispatch } from 'react-redux';
import { useFavorites } from '../../../hooks/useFavorites';
import { useActions } from '../../../hooks/useFavsAction';
import { useAuth } from '../../../hooks/useAuth';
import { ToastContainer, toast } from "react-toastify";
import { Navigate, useNavigate } from 'react-router-dom';

export function Card(tour) {
    const navigate = useNavigate();

    const currentUser = useAuth();
    const [open, setOpen] = useState('tour_btn closed')
    const { favorites } = useFavorites();
    const isExists = favorites.some(r => r.id === tour.id);
    const { toggleFavorites } = useActions();

    return (
        <div className="tour_item">
            <div className="tour_left">
                <img className='tour_img' src={tour.images[0][0]} alt="" />
                <button onClick={() => {currentUser.email? toggleFavorites(tour) : navigate('/signin') }}>
                    {
                        
                        isExists ?
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1.0667 0C0.783793 0 0.512474 0.112384 0.312429 0.312429C0.112384 0.512474 0 0.783793 0 1.0667C0 1.34961 0.112384 1.62093 0.312429 1.82097C0.512474 2.02102 0.783793 2.1334 1.0667 2.1334H3.43477L4.29027 5.56177L7.4861 22.597C7.53186 22.8414 7.66158 23.0622 7.85285 23.2211C8.04412 23.38 8.28491 23.4672 8.5336 23.4674H10.667C9.53537 23.4674 8.45009 23.9169 7.64991 24.7171C6.84973 25.5173 6.4002 26.6026 6.4002 27.7342C6.4002 28.8658 6.84973 29.9511 7.64991 30.7513C8.45009 31.5515 9.53537 32.001 10.667 32.001C11.7986 32.001 12.8839 31.5515 13.6841 30.7513C14.4843 29.9511 14.9338 28.8658 14.9338 27.7342C14.9338 26.6026 14.4843 25.5173 13.6841 24.7171C12.8839 23.9169 11.7986 23.4674 10.667 23.4674H25.6008C24.4692 23.4674 23.3839 23.9169 22.5837 24.7171C21.7835 25.5173 21.334 26.6026 21.334 27.7342C21.334 28.8658 21.7835 29.9511 22.5837 30.7513C23.3839 31.5515 24.4692 32.001 25.6008 32.001C26.7324 32.001 27.8177 31.5515 28.6179 30.7513C29.4181 29.9511 29.8676 28.8658 29.8676 27.7342C29.8676 26.6026 29.4181 25.5173 28.6179 24.7171C27.8177 23.9169 26.7324 23.4674 25.6008 23.4674H27.7342C27.9829 23.4672 28.2237 23.38 28.4149 23.2211C28.6062 23.0622 28.7359 22.8414 28.7817 22.597L31.9818 5.52977C32.0106 5.37582 32.0052 5.21741 31.9659 5.06579C31.9266 4.91418 31.8543 4.77308 31.7544 4.65253C31.6544 4.53197 31.5291 4.43491 31.3873 4.36824C31.2456 4.30158 31.0909 4.26694 30.9343 4.2668H6.16552L5.3015 0.808558C5.24392 0.57769 5.1108 0.372702 4.92331 0.226193C4.73583 0.0796839 4.50474 6.57332e-05 4.2668 0H1.0667ZM12.8004 27.7342C12.8004 28.3 12.5756 28.8426 12.1755 29.2427C11.7754 29.6428 11.2328 29.8676 10.667 29.8676C10.1012 29.8676 9.55855 29.6428 9.15846 29.2427C8.75837 28.8426 8.5336 28.3 8.5336 27.7342C8.5336 27.1684 8.75837 26.6257 9.15846 26.2256C9.55855 25.8256 10.1012 25.6008 10.667 25.6008C11.2328 25.6008 11.7754 25.8256 12.1755 26.2256C12.5756 26.6257 12.8004 27.1684 12.8004 27.7342ZM27.7342 27.7342C27.7342 28.3 27.5094 28.8426 27.1093 29.2427C26.7092 29.6428 26.1666 29.8676 25.6008 29.8676C25.035 29.8676 24.4923 29.6428 24.0923 29.2427C23.6922 28.8426 23.4674 28.3 23.4674 27.7342C23.4674 27.1684 23.6922 26.6257 24.0923 26.2256C24.4923 25.8256 25.035 25.6008 25.6008 25.6008C26.1666 25.6008 26.7092 25.8256 27.1093 26.2256C27.5094 26.6257 27.7342 27.1684 27.7342 27.7342ZM15.689 9.91177L18.1339 12.3588L20.5788 9.91177C20.7791 9.71148 21.0507 9.59895 21.334 9.59895C21.6173 9.59895 21.8889 9.71148 22.0892 9.91177C22.2895 10.1121 22.402 10.3837 22.402 10.667C22.402 10.9503 22.2895 11.2219 22.0892 11.4222L19.6422 13.8671L22.0892 16.312C22.2895 16.5123 22.402 16.7839 22.402 17.0672C22.402 17.3505 22.2895 17.6221 22.0892 17.8224C21.8889 18.0227 21.6173 18.1352 21.334 18.1352C21.0507 18.1352 20.7791 18.0227 20.5788 17.8224L18.1339 15.3754L15.689 17.8224C15.5898 17.9216 15.4721 18.0003 15.3425 18.0539C15.2129 18.1076 15.0741 18.1352 14.9338 18.1352C14.7935 18.1352 14.6547 18.1076 14.5251 18.0539C14.3955 18.0003 14.2777 17.9216 14.1786 17.8224C14.0794 17.7232 14.0007 17.6055 13.947 17.4759C13.8934 17.3463 13.8657 17.2075 13.8657 17.0672C13.8657 16.9269 13.8934 16.7881 13.947 16.6585C14.0007 16.5289 14.0794 16.4111 14.1786 16.312L16.6256 13.8671L14.1786 11.4222C14.0794 11.323 14.0007 11.2053 13.947 11.0757C13.8934 10.9461 13.8657 10.8073 13.8657 10.667C13.8657 10.5267 13.8934 10.3879 13.947 10.2583C14.0007 10.1287 14.0794 10.011 14.1786 9.91177C14.2777 9.8126 14.3955 9.73392 14.5251 9.68025C14.6547 9.62657 14.7935 9.59895 14.9338 9.59895C15.0741 9.59895 15.2129 9.62657 15.3425 9.68025C15.4721 9.73392 15.5898 9.8126 15.689 9.91177Z" fill="white" />
                            </svg>
                            : <svg width="32" height="29" viewBox="0 0 32 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M10.71 28.5593C12.0244 28.5593 13.09 27.4938 13.09 26.1794C13.09 24.865 12.0244 23.7994 10.71 23.7994C9.39562 23.7994 8.33008 24.865 8.33008 26.1794C8.33008 27.4938 9.39562 28.5593 10.71 28.5593Z" fill="black" />
                                <path d="M27.3692 28.5593C28.6836 28.5593 29.7491 27.4938 29.7491 26.1794C29.7491 24.865 28.6836 23.7994 27.3692 23.7994C26.0548 23.7994 24.9893 24.865 24.9893 26.1794C24.9893 27.4938 26.0548 28.5593 27.3692 28.5593Z" fill="black" />
                                <path d="M31.5938 4.22291C31.4266 4.01842 31.216 3.85373 30.9772 3.74078C30.7384 3.62783 30.4775 3.56946 30.2134 3.56992H7.57789L7.12198 0.983215C7.07337 0.707683 6.92923 0.458091 6.71487 0.278281C6.50051 0.0984704 6.22965 -5.87857e-05 5.94986 2.63134e-08H1.18997C0.874372 2.63134e-08 0.571698 0.125372 0.348535 0.348535C0.125372 0.571698 0 0.874372 0 1.18997C0 1.50557 0.125372 1.80825 0.348535 2.03141C0.571698 2.25457 0.874372 2.37994 1.18997 2.37994H4.95177L8.34766 21.6263C8.39627 21.9018 8.54041 22.1514 8.75477 22.3312C8.96913 22.511 9.23999 22.6095 9.51978 22.6095H28.5593C28.8749 22.6095 29.1776 22.4841 29.4008 22.2609C29.6239 22.0378 29.7493 21.7351 29.7493 21.4195C29.7493 21.1039 29.6239 20.8012 29.4008 20.5781C29.1776 20.3549 28.8749 20.2295 28.5593 20.2295H10.5179L10.0984 17.8496H28.0714C28.4841 17.8491 28.8839 17.706 29.2033 17.4445C29.5226 17.1831 29.7417 16.8194 29.8237 16.4149L31.9656 5.70517C32.0172 5.44598 32.0107 5.17857 31.9463 4.92223C31.882 4.6659 31.7616 4.42705 31.5938 4.22291Z" fill="black" />
                            </svg>
                            
                    }
                </button>
            </div>
            <div className="tour_center">
                <p className='tour_name'>{tour.name}</p>
                <p className='tour_description'>{tour.body.substr(0, 200)}...</p>
                <div className="tour_cities">
                    <div className='cities_title'>
                        <svg width="12" height="17" viewBox="0 0 12 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M2.36443 2.61378C2.84059 2.08514 3.40695 1.66549 4.03089 1.379C4.65484 1.0925 5.32405 0.944822 6 0.944456C7.36286 0.944456 8.67086 1.54419 9.63557 2.61378C10.6016 3.6864 11.1434 5.13644 11.1429 6.64756C11.1429 9.25709 9.82971 11.6192 8.46171 13.3631C7.88524 14.0945 7.26024 14.7776 6.59186 15.4069C6.39858 15.5895 6.20124 15.7668 6 15.9386C5.79887 15.7667 5.60153 15.5894 5.40814 15.4069C4.73976 14.7776 4.11476 14.0945 3.53829 13.3631C2.17029 11.6192 0.857143 9.25709 0.857143 6.64756C0.857143 5.13406 1.39971 3.68338 2.36443 2.61378ZM5.75314 16.9138L6 16.528L6.24686 16.9138C6.17461 16.9699 6.08838 17 6 17C5.91162 17 5.82539 16.9699 5.75314 16.9138ZM5.75314 16.9138L6 16.528L6.24686 16.9138L6.24857 16.9129L6.25286 16.9095L6.26571 16.8987L6.31629 16.8585C6.35971 16.8236 6.42114 16.7726 6.50057 16.7055C6.65829 16.5724 6.882 16.3764 7.149 16.1247C7.84989 15.4646 8.50527 14.748 9.10971 13.9808C10.5274 12.174 12 9.59568 12 6.64708C12 4.88567 11.3683 3.1951 10.2437 1.94841C9.6879 1.33135 9.0268 0.841528 8.29849 0.507136C7.57017 0.172744 6.78902 0.000391287 6 0C5.21101 0.000329432 4.42988 0.172608 3.70156 0.506918C2.97325 0.841228 2.31214 1.33097 1.75629 1.94794C0.630729 3.19756 -0.000615818 4.88697 4.5074e-07 6.64756C4.5074e-07 9.59568 1.47257 12.174 2.89029 13.9808C3.49473 14.748 4.15011 15.4646 4.851 16.1247C5.11843 16.3764 5.34171 16.5724 5.49943 16.7055C5.5768 16.7712 5.65495 16.8358 5.73386 16.8992L5.74757 16.9095L5.75143 16.9129L5.75314 16.9138ZM4.28571 6.61119C4.28571 6.11022 4.46633 5.62977 4.78782 5.27553C5.10931 4.92129 5.54534 4.72228 6 4.72228C6.45466 4.72228 6.89069 4.92129 7.21218 5.27553C7.53367 5.62977 7.71429 6.11022 7.71429 6.61119C7.71429 7.11216 7.53367 7.59262 7.21218 7.94686C6.89069 8.3011 6.45466 8.50011 6 8.50011C5.54534 8.50011 5.10931 8.3011 4.78782 7.94686C4.46633 7.59262 4.28571 7.11216 4.28571 6.61119ZM6 3.77783C5.31801 3.77783 4.66396 4.07634 4.18173 4.6077C3.69949 5.13906 3.42857 5.85974 3.42857 6.61119C3.42857 7.36265 3.69949 8.08333 4.18173 8.61469C4.66396 9.14605 5.31801 9.44456 6 9.44456C6.68199 9.44456 7.33604 9.14605 7.81828 8.61469C8.30051 8.08333 8.57143 7.36265 8.57143 6.61119C8.57143 5.85974 8.30051 5.13906 7.81828 4.6077C7.33604 4.07634 6.68199 3.77783 6 3.77783Z" fill="rgba(0, 0, 0, 0.65)" />
                        </svg>
                        Города:</div>
                    {tour.cities[0].map(city => {
                        return (
                            <p class='tour_city'>{city}</p>
                        )
                    })}
                </div>
            </div>
            <div className="tour_right">
                <div className="tour_right-info">
                    <p className="tour_price">
                        {tour.price} ₽
                    </p>
                    <div className="tour_dura">
                        <div className="dura_night">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.46667 2.13333V0.533333C7.46667 0.391885 7.52286 0.256229 7.62288 0.15621C7.7229 0.0561903 7.85855 0 8 0C8.14145 0 8.27711 0.0561903 8.37712 0.15621C8.47714 0.256229 8.53333 0.391885 8.53333 0.533333V2.13333C8.53333 2.27478 8.47714 2.41044 8.37712 2.51046C8.27711 2.61048 8.14145 2.66667 8 2.66667C7.85855 2.66667 7.7229 2.61048 7.62288 2.51046C7.52286 2.41044 7.46667 2.27478 7.46667 2.13333ZM8 3.73333C7.15613 3.73333 6.33122 3.98357 5.62957 4.4524C4.92792 4.92122 4.38105 5.58759 4.05811 6.36722C3.73518 7.14685 3.65069 8.00473 3.81532 8.83239C3.97995 9.66004 4.38631 10.4203 4.98301 11.017C5.57972 11.6137 6.33996 12.0201 7.16762 12.1847C7.99527 12.3493 8.85315 12.2648 9.63278 11.9419C10.4124 11.619 11.0788 11.0721 11.5476 10.3704C12.0164 9.66878 12.2667 8.84387 12.2667 8C12.2654 6.86879 11.8155 5.78426 11.0156 4.98438C10.2157 4.18449 9.13121 3.73457 8 3.73333ZM3.356 4.11067C3.45608 4.21074 3.59181 4.26696 3.73333 4.26696C3.87486 4.26696 4.01059 4.21074 4.11067 4.11067C4.21074 4.01059 4.26696 3.87486 4.26696 3.73333C4.26696 3.59181 4.21074 3.45608 4.11067 3.356L3.044 2.28933C2.94393 2.18926 2.80819 2.13304 2.66667 2.13304C2.52514 2.13304 2.38941 2.18926 2.28933 2.28933C2.18926 2.38941 2.13304 2.52514 2.13304 2.66667C2.13304 2.80819 2.18926 2.94393 2.28933 3.044L3.356 4.11067ZM3.356 11.8893L2.28933 12.956C2.18926 13.0561 2.13304 13.1918 2.13304 13.3333C2.13304 13.4749 2.18926 13.6106 2.28933 13.7107C2.38941 13.8107 2.52514 13.867 2.66667 13.867C2.80819 13.867 2.94393 13.8107 3.044 13.7107L4.11067 12.644C4.16022 12.5944 4.19953 12.5356 4.22634 12.4709C4.25316 12.4061 4.26696 12.3367 4.26696 12.2667C4.26696 12.1966 4.25316 12.1272 4.22634 12.0625C4.19953 11.9977 4.16022 11.9389 4.11067 11.8893C4.06112 11.8398 4.00229 11.8005 3.93754 11.7737C3.8728 11.7468 3.80341 11.733 3.73333 11.733C3.66326 11.733 3.59387 11.7468 3.52912 11.7737C3.46438 11.8005 3.40555 11.8398 3.356 11.8893ZM12.2667 4.26667C12.3367 4.26672 12.4061 4.25297 12.4709 4.22621C12.5356 4.19944 12.5944 4.16018 12.644 4.11067L13.7107 3.044C13.8107 2.94393 13.867 2.80819 13.867 2.66667C13.867 2.52514 13.8107 2.38941 13.7107 2.28933C13.6106 2.18926 13.4749 2.13304 13.3333 2.13304C13.1918 2.13304 13.0561 2.18926 12.956 2.28933L11.8893 3.356C11.8147 3.43059 11.7638 3.52566 11.7432 3.62917C11.7226 3.73268 11.7331 3.83998 11.7735 3.93749C11.8139 4.03499 11.8824 4.11832 11.9701 4.17692C12.0579 4.23552 12.1611 4.26675 12.2667 4.26667ZM12.644 11.8893C12.5439 11.7893 12.4082 11.733 12.2667 11.733C12.1251 11.733 11.9894 11.7893 11.8893 11.8893C11.7893 11.9894 11.733 12.1251 11.733 12.2667C11.733 12.4082 11.7893 12.5439 11.8893 12.644L12.956 13.7107C13.0056 13.7602 13.0644 13.7995 13.1291 13.8263C13.1939 13.8532 13.2633 13.867 13.3333 13.867C13.4034 13.867 13.4728 13.8532 13.5375 13.8263C13.6023 13.7995 13.6611 13.7602 13.7107 13.7107C13.7602 13.6611 13.7995 13.6023 13.8263 13.5375C13.8532 13.4728 13.867 13.4034 13.867 13.3333C13.867 13.2633 13.8532 13.1939 13.8263 13.1291C13.7995 13.0644 13.7602 13.0056 13.7107 12.956L12.644 11.8893ZM2.66667 8C2.66667 7.85855 2.61048 7.7229 2.51046 7.62288C2.41044 7.52286 2.27478 7.46667 2.13333 7.46667H0.533333C0.391885 7.46667 0.256229 7.52286 0.15621 7.62288C0.0561903 7.7229 0 7.85855 0 8C0 8.14145 0.0561903 8.27711 0.15621 8.37712C0.256229 8.47714 0.391885 8.53333 0.533333 8.53333H2.13333C2.27478 8.53333 2.41044 8.47714 2.51046 8.37712C2.61048 8.27711 2.66667 8.14145 2.66667 8ZM8 13.3333C7.85855 13.3333 7.7229 13.3895 7.62288 13.4895C7.52286 13.5896 7.46667 13.7252 7.46667 13.8667V15.4667C7.46667 15.6081 7.52286 15.7438 7.62288 15.8438C7.7229 15.9438 7.85855 16 8 16C8.14145 16 8.27711 15.9438 8.37712 15.8438C8.47714 15.7438 8.53333 15.6081 8.53333 15.4667V13.8667C8.53333 13.7252 8.47714 13.5896 8.37712 13.4895C8.27711 13.3895 8.14145 13.3333 8 13.3333ZM15.4667 7.46667H13.8667C13.7252 7.46667 13.5896 7.52286 13.4895 7.62288C13.3895 7.7229 13.3333 7.85855 13.3333 8C13.3333 8.14145 13.3895 8.27711 13.4895 8.37712C13.5896 8.47714 13.7252 8.53333 13.8667 8.53333H15.4667C15.6081 8.53333 15.7438 8.47714 15.8438 8.37712C15.9438 8.27711 16 8.14145 16 8C16 7.85855 15.9438 7.7229 15.8438 7.62288C15.7438 7.52286 15.6081 7.46667 15.4667 7.46667Z" fill="#0093D0" />
                            </svg>
                            <p className="dura_night-text">{tour.duration} дней</p>
                        </div>
                        <div className="dura_night">

                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8.28567 16C6.08817 16 3.98068 15.127 2.42682 13.5732C0.872952 12.0193 0 9.91183 0 7.71433C0 4.35721 1.92856 1.34722 4.91462 0.0475886C5.01985 0.00172278 5.13647 -0.0113816 5.24926 0.00998327C5.36206 0.0313481 5.4658 0.0861915 5.54698 0.167367C5.62815 0.248543 5.68299 0.352286 5.70436 0.46508C5.72572 0.577874 5.71262 0.694488 5.66675 0.799727C5.3239 1.58687 5.14283 2.59507 5.14283 3.71435C5.14283 7.6529 8.3471 10.8572 12.2856 10.8572C13.4049 10.8572 14.4131 10.6761 15.2003 10.3332C15.3055 10.2874 15.4221 10.2743 15.5349 10.2956C15.6477 10.317 15.7515 10.3718 15.8326 10.453C15.9138 10.5342 15.9687 10.6379 15.99 10.7507C16.0114 10.8635 15.9983 10.9801 15.9524 11.0854C14.6528 14.0714 11.6428 16 8.28567 16Z" fill="#0093D0" />
                            </svg>

                            <p className="dura_night-text">{tour.duration - 1} ночей</p>
                        </div>

                    </div>
                    <div className="tour_rating">

                        <svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 0.5L13.4697 8.10081H21.4616L14.996 12.7984L17.4656 20.3992L11 15.7016L4.53436 20.3992L7.00402 12.7984L0.538379 8.10081H8.53035L11 0.5Z" fill="#0093D0" />
                        </svg>
                        <p>{tour.rating}</p>
                        <span>{tour.reviewsCount.total} отзывов</span>
                    </div>
                    <p className="tour_type">
                        Тип тура:
                        {tour.types[0].map(type => {
                            return (<p className='tour_type-name'>{type}</p>)
                        }
                        )}
                    </p>
                    {/* <p className="tour_date">
                        Дата начала тура:<br />
                        <span>
                            {tour.date}
                        </span>
                    </p> */}
                </div>
                <p className="tour_descrpp">*стоимость указана на 1 чел.</p>
                <Link to={`/catalog/tour/id/${tour.id}`}>
                    <div className={open} onMouseLeave={() => { setOpen('tour_btn closed') }} onMouseEnter={() => { setOpen('tour_btn open') }}>
                        <p>Смотреть тур</p>

                        <svg width="20" height="16" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13.2916 0.293265C13.1986 0.386132 13.1249 0.496416 13.0746 0.617806C13.0242 0.739196 12.9983 0.869312 12.9983 1.00072C12.9983 1.13212 13.0242 1.26224 13.0746 1.38363C13.1249 1.50502 13.1986 1.6153 13.2916 1.70817L20.5849 9.00018H0.999935C0.734737 9.00018 0.480399 9.10553 0.292875 9.29306C0.105351 9.48058 2.43697e-06 9.73492 2.43697e-06 10.0001C2.43697e-06 10.2653 0.105351 10.5197 0.292875 10.7072C0.480399 10.8947 0.734737 11 0.999935 11H20.5849L13.2916 18.2921C13.104 18.4797 12.9986 18.7342 12.9986 18.9995C12.9986 19.2649 13.104 19.5193 13.2916 19.707C13.4792 19.8946 13.7337 20 13.9991 20C14.2644 20 14.5189 19.8946 14.7065 19.707L23.7059 10.7076C23.7989 10.6147 23.8726 10.5044 23.923 10.383C23.9733 10.2616 23.9992 10.1315 23.9992 10.0001C23.9992 9.86871 23.9733 9.73859 23.923 9.6172C23.8726 9.49581 23.7989 9.38553 23.7059 9.29266L14.7065 0.293265C14.6136 0.200295 14.5034 0.126541 14.382 0.0762198C14.2606 0.0258989 14.1305 -3.86717e-07 13.9991 -3.86717e-07C13.8677 -3.86717e-07 13.7375 0.0258989 13.6161 0.0762198C13.4948 0.126541 13.3845 0.200295 13.2916 0.293265Z" fill="white" />
                        </svg>

                    </div>
                </Link>


            </div>
            <ToastContainer />
        </div>
        
    )
}

// style={{backgroundImage:url(props.images[0]), backgroundSize:cover}}