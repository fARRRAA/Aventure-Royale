import { Link } from 'react-router-dom'
import './topHeader.css'
import { useAuth } from '../../../hooks/useAuth';
import { useDispatch } from 'react-redux';
import { removeUser } from '../../../store/slices/userSlice';
import { ToastContainer, toast } from "react-toastify";
import { Navigate, useNavigate } from 'react-router-dom';
import { useEffect, useState } from 'react';
import { useFavorites } from '../../../hooks/useFavorites';
import { useActions } from '../../../hooks/useFavsAction';
import { FavItem } from '../../FavItem/FavItem';

export function TopHeader() {
    const dispatch = useDispatch();
    const currentUser = useAuth();
    const { favorites } = useFavorites();
    const { removeFavorites } = useActions();
    const navigate = useNavigate();
    const [countShow, setCountShow] = useState('count_items hidden');
    const [show, setShow] = useState('cart_list hidden')
    const [open, setOpen] = useState('tour_btn closed')
    useEffect(() => {
        if (favorites.length > 0) {
            setCountShow('count_items active');
        }
        else {
            setCountShow('count_items hidden');
        }
        
    }, [favorites])
    useEffect(() => {
        if(!currentUser.email && favorites.length>0){
            removeFavorites();
        }
    },[currentUser]);
    return (

        <>
            <div className="topheader">
                <Link to='/'>
                    <p className="topheader_logo">
                        Aventure <span>royale</span>
                    </p>
                </Link>
                <nav className="topheader_nav">
                    <div className="topheader_phone">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M23.0978 16.7662L17.1952 14.1249C16.9664 14.0259 16.7165 13.9854 16.4682 14.0073C16.2198 14.0291 15.9808 14.1125 15.7727 14.2499C15.7561 14.2605 15.7402 14.2722 15.7252 14.2849L12.6252 16.9274C12.5562 16.9695 12.4779 16.9939 12.3972 16.9985C12.3165 17.0031 12.236 16.9877 12.1627 16.9537C10.1327 15.9737 8.03137 13.8887 7.05136 11.8824C7.01669 11.8096 7.0006 11.7294 7.00453 11.6489C7.00846 11.5684 7.03228 11.4902 7.07386 11.4211L9.7239 8.26983C9.7364 8.25483 9.74765 8.23858 9.7589 8.22233C9.89589 8.01458 9.97904 7.77601 10.0009 7.52812C10.0227 7.28022 9.98249 7.0308 9.8839 6.80231L7.23761 0.909728C7.10986 0.611282 6.88873 0.362336 6.60743 0.200276C6.32614 0.0382149 5.99986 -0.0282135 5.67759 0.0109659C4.10453 0.218369 2.66076 0.991308 1.61595 2.18542C0.571132 3.37952 -0.00327498 4.91314 1.40467e-05 6.4998C1.40467e-05 16.1499 7.85012 24 17.5003 24C19.0869 24.0033 20.6205 23.4289 21.8146 22.3841C23.0087 21.3393 23.7817 19.8955 23.9891 18.3225C24.028 18.0017 23.9622 17.6769 23.8017 17.3965C23.6411 17.1161 23.3942 16.895 23.0978 16.7662ZM23.0003 18.1975C22.8238 19.5297 22.1681 20.752 21.1559 21.6359C20.1436 22.5197 18.8441 23.0047 17.5003 23C8.40263 23 1.00003 15.5974 1.00003 6.4998C0.995372 5.15597 1.48032 3.85644 2.3642 2.84419C3.24809 1.83193 4.47039 1.17625 5.80259 0.999729C5.82258 0.998528 5.84261 0.998528 5.86259 0.999729C5.96124 1.00057 6.05743 1.03057 6.13906 1.08596C6.22069 1.14134 6.28411 1.21963 6.32135 1.31098L8.96014 7.20356C8.99093 7.27558 9.00436 7.35383 8.99937 7.43199C8.99438 7.51016 8.97109 7.58606 8.93139 7.65357L6.2826 10.8036C6.2701 10.8199 6.2576 10.8349 6.24635 10.8524C6.10523 11.0682 6.02212 11.3167 6.00505 11.574C5.98797 11.8312 6.03749 12.0886 6.14885 12.3211C7.23511 14.5449 9.47514 16.7687 11.7239 17.855C11.9581 17.9656 12.2169 18.0137 12.4751 17.9947C12.7334 17.9756 12.9823 17.89 13.1977 17.7462L13.2439 17.7112L16.3477 15.0712C16.4141 15.0306 16.4892 15.0064 16.5668 15.0005C16.6444 14.9947 16.7223 15.0073 16.794 15.0374L22.6953 17.6825C22.7949 17.7239 22.8784 17.7965 22.9334 17.8893C22.9884 17.9821 23.0118 18.0902 23.0003 18.1975Z" fill="rgba(0, 0, 0, 0.75)" />
                        </svg>
                        <p>+7 (495) 502 10 11</p>
                    </div>
                    <div className="topheader_geopos">

                        <svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M3.06504 3.07504C3.68229 2.4531 4.41647 1.9594 5.2253 1.62235C6.03412 1.2853 6.90163 1.11156 7.77788 1.11112C9.54456 1.11112 11.2401 1.81669 12.4907 3.07504C13.743 4.33694 14.4453 6.04287 14.4446 7.82065C14.4446 10.8907 12.7424 13.6696 10.969 15.7213C10.2217 16.5817 9.41153 17.3854 8.54511 18.1258C8.29456 18.3406 8.03874 18.5492 7.77788 18.7513C7.51715 18.549 7.26133 18.3404 7.01064 18.1258C6.14422 17.3854 5.33401 16.5817 4.58672 15.7213C2.81337 13.6696 1.11113 10.8907 1.11113 7.82065C1.11113 6.04008 1.81447 4.33339 3.06504 3.07504ZM7.45787 19.8986L7.77788 19.4447L8.09788 19.8986C8.00422 19.9646 7.89245 20 7.77788 20C7.6633 20 7.55153 19.9646 7.45787 19.8986ZM7.45787 19.8986L7.77788 19.4447L8.09788 19.8986L8.1001 19.8975L8.10566 19.8936L8.12232 19.8808L8.18788 19.8336C8.24418 19.7925 8.32381 19.7325 8.42677 19.6536C8.63122 19.4969 8.92122 19.2664 9.26734 18.9702C10.1759 18.1936 11.0255 17.3506 11.809 16.448C13.6468 14.3224 15.5558 11.289 15.5558 7.8201C15.5558 5.74785 14.7369 3.75894 13.2791 2.29225C12.5585 1.5663 11.7016 0.990033 10.7574 0.596631C9.8133 0.203228 8.80069 0.000460337 7.77788 0C6.7551 0.000387567 5.74251 0.203068 4.79838 0.596374C3.85426 0.98968 2.99725 1.56584 2.2767 2.2917C0.817622 3.76184 -0.000798293 5.74937 5.843e-07 7.82065C5.843e-07 11.289 1.90891 14.3224 3.74671 16.448C4.53026 17.3506 5.37983 18.1936 6.28841 18.9702C6.63508 19.2664 6.92453 19.4969 7.12898 19.6536C7.22927 19.7308 7.33058 19.8068 7.43287 19.8814L7.45065 19.8936L7.45565 19.8975L7.45787 19.8986ZM5.55563 7.77787C5.55563 7.1885 5.78976 6.62326 6.20651 6.20651C6.62326 5.78975 7.1885 5.55562 7.77788 5.55562C8.36725 5.55562 8.93249 5.78975 9.34924 6.20651C9.766 6.62326 10.0001 7.1885 10.0001 7.77787C10.0001 8.36725 9.766 8.93249 9.34924 9.34924C8.93249 9.766 8.36725 10.0001 7.77788 10.0001C7.1885 10.0001 6.62326 9.766 6.20651 9.34924C5.78976 8.93249 5.55563 8.36725 5.55563 7.77787ZM7.77788 4.4445C6.89381 4.4445 6.04595 4.79569 5.42082 5.42082C4.79569 6.04595 4.4445 6.89381 4.4445 7.77787C4.4445 8.66194 4.79569 9.5098 5.42082 10.1349C6.04595 10.7601 6.89381 11.1112 7.77788 11.1112C8.66194 11.1112 9.5098 10.7601 10.1349 10.1349C10.7601 9.5098 11.1113 8.66194 11.1113 7.77787C11.1113 6.89381 10.7601 6.04595 10.1349 5.42082C9.5098 4.79569 8.66194 4.4445 7.77788 4.4445Z" fill="rgba(0, 0, 0, 0.75)" />
                        </svg>
                        <p>Где купить</p>
                    </div>
                    <div className="topheader_map">

                        <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13.8836 20L6.31074 17.3495L1.31516 19.2806C0.992048 19.4009 0.692078 19.366 0.415247 19.1758C0.138416 18.9857 0 18.7181 0 18.3731V2.93702C0 2.71151 0.0546932 2.50578 0.164079 2.31983C0.273466 2.13387 0.432496 2.00471 0.641171 1.93235L6.31074 0L13.8836 2.65051L18.8792 0.719424C19.2023 0.599099 19.5023 0.621818 19.7791 0.787581C20.056 0.953343 20.1944 1.20072 20.1944 1.52972V17.1602C20.1944 17.4017 20.1275 17.6112 19.9937 17.7887C19.8607 17.9671 19.6815 18.0925 19.456 18.1648L13.8836 20ZM13.2526 18.4602V3.69305L6.94181 1.4906V16.2577L13.2526 18.4602ZM14.5147 18.4602L18.9322 17.0049V2.04847L14.5147 3.69431V18.4602ZM1.26215 17.9515L5.67967 16.2577V1.4906L1.26215 2.99508V17.9515Z" fill="rgba(0, 0, 0, 0.75)" />
                        </svg>
                        <p>Казань</p>

                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.3362 6.44627L10.48 12.21C10.3522 12.3364 10.1797 12.4073 10 12.4073C9.82026 12.4073 9.64778 12.3364 9.52 12.21L3.66375 6.44752C3.53518 6.32117 3.36213 6.25038 3.18187 6.25038C3.00162 6.25038 2.82857 6.32117 2.7 6.44752C2.63669 6.50924 2.58637 6.58301 2.55202 6.66448C2.51766 6.74595 2.49996 6.83347 2.49996 6.92189C2.49996 7.01031 2.51766 7.09783 2.55202 7.1793C2.58637 7.26077 2.63669 7.33454 2.7 7.39627L8.555 13.1588C8.94065 13.5374 9.45953 13.7496 10 13.7496C10.5405 13.7496 11.0593 13.5374 11.445 13.1588L17.3 7.39627C17.3635 7.33453 17.414 7.26068 17.4484 7.17909C17.4829 7.09751 17.5007 7.00983 17.5007 6.92127C17.5007 6.8327 17.4829 6.74503 17.4484 6.66344C17.414 6.58185 17.3635 6.50801 17.3 6.44627C17.1714 6.31992 16.9984 6.24913 16.8181 6.24913C16.6379 6.24913 16.4648 6.31992 16.3362 6.44627Z" fill="#1E1E1E" />
                        </svg>

                    </div>

                    <div className="topheader_icons">
                        <div className='cart'>
                            <div className="cart_icon" onClick={() => { show == 'cart_list hidden' ? setShow('cart_list active') : setShow('cart_list hidden') }}>
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M0 0.666687C0 0.489871 0.0702401 0.320296 0.195268 0.195268C0.320296 0.07024 0.489871 0 0.666687 0H2.66675C2.81546 4.10832e-05 2.95989 0.0498025 3.07707 0.141371C3.19425 0.232939 3.27745 0.361056 3.31344 0.505349L3.85345 2.66675H19.3339C19.4318 2.66684 19.5285 2.68849 19.6171 2.73015C19.7057 2.77182 19.784 2.83248 19.8465 2.90783C19.909 2.98318 19.9541 3.07136 19.9787 3.16612C20.0032 3.26088 20.0066 3.35989 19.9886 3.45611L17.9886 14.1231C17.96 14.2759 17.8789 14.4139 17.7593 14.5132C17.6398 14.6125 17.4893 14.667 17.3339 14.6671H5.3335C5.17807 14.667 5.02758 14.6125 4.90803 14.5132C4.78849 14.4139 4.70741 14.2759 4.67881 14.1231L2.68008 3.47611L2.14673 1.33337H0.666687C0.489871 1.33337 0.320296 1.26313 0.195268 1.13811C0.0702401 1.01308 0 0.843504 0 0.666687ZM4.13613 4.00012L5.88685 13.3337H16.7805L18.5312 4.00012H4.13613ZM6.66687 14.6671C5.95961 14.6671 5.28131 14.9481 4.7812 15.4482C4.28108 15.9483 4.00012 16.6266 4.00012 17.3339C4.00012 18.0411 4.28108 18.7194 4.7812 19.2195C5.28131 19.7197 5.95961 20.0006 6.66687 20.0006C7.37414 20.0006 8.05244 19.7197 8.55255 19.2195C9.05266 18.7194 9.33362 18.0411 9.33362 17.3339C9.33362 16.6266 9.05266 15.9483 8.55255 15.4482C8.05244 14.9481 7.37414 14.6671 6.66687 14.6671ZM16.0005 14.6671C15.2932 14.6671 14.6149 14.9481 14.1148 15.4482C13.6147 15.9483 13.3337 16.6266 13.3337 17.3339C13.3337 18.0411 13.6147 18.7194 14.1148 19.2195C14.6149 19.7197 15.2932 20.0006 16.0005 20.0006C16.7078 20.0006 17.3861 19.7197 17.8862 19.2195C18.3863 18.7194 18.6672 18.0411 18.6672 17.3339C18.6672 16.6266 18.3863 15.9483 17.8862 15.4482C17.3861 14.9481 16.7078 14.6671 16.0005 14.6671ZM6.66687 16.0005C7.02051 16.0005 7.35965 16.141 7.60971 16.391C7.85977 16.6411 8.00025 16.9802 8.00025 17.3339C8.00025 17.6875 7.85977 18.0267 7.60971 18.2767C7.35965 18.5268 7.02051 18.6672 6.66687 18.6672C6.31324 18.6672 5.97409 18.5268 5.72403 18.2767C5.47398 18.0267 5.3335 17.6875 5.3335 17.3339C5.3335 16.9802 5.47398 16.6411 5.72403 16.391C5.97409 16.141 6.31324 16.0005 6.66687 16.0005ZM16.0005 16.0005C16.3541 16.0005 16.6933 16.141 16.9433 16.391C17.1934 16.6411 17.3339 16.9802 17.3339 17.3339C17.3339 17.6875 17.1934 18.0267 16.9433 18.2767C16.6933 18.5268 16.3541 18.6672 16.0005 18.6672C15.6469 18.6672 15.3077 18.5268 15.0577 18.2767C14.8076 18.0267 14.6671 17.6875 14.6671 17.3339C14.6671 16.9802 14.8076 16.6411 15.0577 16.391C15.3077 16.141 15.6469 16.0005 16.0005 16.0005Z" fill="rgba(0, 0, 0, 0.75)" />
                                </svg>
                                <div className={countShow}>{favorites.length}</div>
                            </div>
                            <div className={show}>
                                <div className="cart_header">
                                    <p className="cart_list-title">Список избранного</p>
                                    <button style={{ fontSize: 30 }} onClick={() => { setShow('cart_list hidden') }}>×</button>
                                </div>
                                <div className="cart_wrapper">
                                    {
                                        favorites.length > 0 ? favorites.map((fav, i) => {
                                            return <FavItem key={i} {...fav} />
                                        })
                                            : <p>Ваша корзина пуста...</p>
                                    }
                                </div>
                                {currentUser.email&& favorites.length>0&& <Link to='/user/payment' onClick={()=>{setShow('cart_list hidden')}}>
                                    <div className="cart_btn-pay">
                                        <p>Оплатить</p>
                                    </div>
                                </Link>}
                            </div>
                        </div>

                        <Link to='/user/profile'>
                            <svg width="25" height="25" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20.4617 10.7286C20.4649 12.6604 19.8903 14.5491 18.8117 16.1519C17.9223 17.4785 16.7197 18.5655 15.3103 19.3168C13.9008 20.068 12.328 20.4605 10.7308 20.4594C9.13366 20.4605 7.56083 20.068 6.1514 19.3168C4.74197 18.5655 3.53936 17.4785 2.64992 16.1519C1.80304 14.8895 1.26371 13.4462 1.07515 11.9378C0.886592 10.4294 1.05406 8.89782 1.56411 7.46581C2.07417 6.03379 2.91264 4.74118 4.0123 3.69162C5.11197 2.64206 6.44223 1.86473 7.89646 1.42194C9.35069 0.979159 10.8884 0.883239 12.3864 1.14187C13.8844 1.40051 15.3009 2.0065 16.5225 2.91128C17.7441 3.81605 18.7367 4.99444 19.4207 6.35197C20.1048 7.7095 20.4613 9.20842 20.4617 10.7286Z" stroke="black" />
                                <path d="M12.3526 7.48499C12.3526 7.91512 12.1818 8.32763 11.8776 8.63178C11.5735 8.93593 11.161 9.10679 10.7308 9.10679V10.188C11.0858 10.188 11.4373 10.1181 11.7652 9.98224C12.0932 9.8464 12.3911 9.6473 12.6421 9.3963C12.8931 9.14531 13.0922 8.84733 13.2281 8.51939C13.3639 8.19144 13.4338 7.83995 13.4338 7.48499H12.3526ZM10.7308 9.10679C10.3007 9.10679 9.88819 8.93593 9.58404 8.63178C9.2799 8.32763 9.10903 7.91512 9.10903 7.48499H8.02782C8.02782 7.83995 8.09774 8.19144 8.23358 8.51939C8.36942 8.84733 8.56852 9.14531 8.81952 9.3963C9.32643 9.90322 10.0139 10.188 10.7308 10.188V9.10679ZM9.10903 7.48499C9.10903 7.05486 9.2799 6.64235 9.58404 6.3382C9.88819 6.03405 10.3007 5.86319 10.7308 5.86319V4.78198C10.0139 4.78198 9.32643 5.06676 8.81952 5.57367C8.3126 6.08059 8.02782 6.76811 8.02782 7.48499H9.10903ZM10.7308 5.86319C11.161 5.86319 11.5735 6.03405 11.8776 6.3382C12.1818 6.64235 12.3526 7.05486 12.3526 7.48499H13.4338C13.4338 6.76811 13.1491 6.08059 12.6421 5.57367C12.1352 5.06676 11.4477 4.78198 10.7308 4.78198V5.86319ZM3.34189 17.0601L2.82291 16.9066L2.73966 17.1888L2.93103 17.4126L3.34189 17.0601ZM18.1198 17.0601L18.5306 17.4126L18.722 17.1888L18.6377 16.9066L18.1198 17.0601ZM7.48722 14.5128H13.9744V13.4316H7.48722V14.5128ZM7.48722 13.4316C6.43947 13.4318 5.41974 13.7701 4.5796 14.3961C3.73946 15.0222 3.12267 15.9026 2.82291 16.9066L3.85979 17.2147C4.09318 16.434 4.57221 15.7494 5.22572 15.2626C5.87923 14.7758 6.67235 14.5129 7.48722 14.5128V13.4316ZM10.7308 19.9188C9.40449 19.9202 8.09362 19.6339 6.8887 19.0795C5.68378 18.5251 4.61348 17.7159 3.75167 16.7077L2.93103 17.4126C3.89444 18.5389 5.09067 19.443 6.43723 20.0623C7.7838 20.6816 9.24867 21.0016 10.7308 21V19.9188ZM13.9744 14.5128C14.7895 14.5129 15.5827 14.7761 16.2362 15.263C16.8897 15.75 17.3687 16.4349 17.6019 17.2158L18.6377 16.9066C18.3379 15.9026 17.7222 15.0222 16.8821 14.3961C16.0419 13.7701 15.0222 13.4318 13.9744 13.4316V14.5128ZM17.71 16.7077C16.8482 17.7159 15.7779 18.5251 14.573 19.0795C13.368 19.6339 12.0572 19.9202 10.7308 19.9188V21C12.213 21.0016 13.6779 20.6816 15.0244 20.0623C16.371 19.443 17.5672 18.5389 18.5306 17.4126L17.71 16.7077Z" fill="rgba(0, 0, 0, 0.75)" />
                            </svg>
                        </Link>
                    </div>
                    <div className="topheader_auth">
                        <div>{currentUser.email ? <Link to='/' onClick={() => { dispatch(removeUser()) }}>Выйти</Link> : <Link to='/signin'>Войти</Link>}</div>
                    </div>
                </nav>
            </div >
            <ToastContainer />
        </>
    )
}